# 2026 In-Out Dashboard (MLP Time Attendance)

ระบบลงเวลาพนักงานผ่าน LINE LIFF + Firebase Firestore พร้อมหน้า Admin สำหรับดูรายงาน/จัดการข้อมูล

## ภาพรวม

- ฝั่งพนักงาน: `index.html`
- ฝั่งผู้ดูแลระบบ (Admin): `admin.html`

## ฟีเจอร์ (สรุปให้ครบถ้วนตามสถานะก่อนการ git ครั้งแรกด้วย Windsurf ในวันที่ 2026-02-13)

> หมายเหตุ: รายการนี้ตั้งใจสรุป “ของเดิมที่มีอยู่แล้ว” ก่อนเริ่มการเปลี่ยนแปลงในวันนี้ เพื่อใช้อ้างอิง baseline

### 1) ระบบพนักงาน (หน้าเวลาเข้า-ออก)

- เข้าระบบผ่าน **LINE LIFF**
- ดึงข้อมูลโปรไฟล์จาก LINE
  - `lineUserId`
  - `displayName`
  - `pictureUrl`

#### การจัดการผู้ใช้งาน

- ลงทะเบียนพนักงานใหม่
  - รหัสพนักงาน
  - ชื่อ-นามสกุล
  - แผนก
- สถานะผู้ใช้งาน
  - Pending (รออนุมัติ)
  - Approved (อนุมัติแล้ว)
  - กรณีอื่น ๆ: ระงับการใช้งาน/ให้ติดต่อแอดมิน

#### ลงเวลาเข้า-ออกงาน

- บันทึกเวลา **เข้างาน / ออกงาน**
- บังคับขอพิกัด GPS ก่อนบันทึก
- บันทึกข้อมูลลง Firestore collection: `attendance`
  - `userId` (อ้างอิงไปยัง LINE user)
  - `name`, `empId`, `dept`
  - `type` (เข้างาน/ออกงาน)
  - `timestamp`
  - `location` (lat/lng)
  - `mapUrl`
  - `userAgent`
- ส่งข้อความแจ้งเตือนเข้า LINE chat (กรณีเปิดใน LIFF client)

#### Smart Buttons + History

- ปุ่มเข้างาน/ออกงาน แสดงตามสถานะล่าสุดของวันนี้
- แสดงประวัติการลงเวลาของวันปัจจุบัน

#### Auto Checkout

- หากลงเวลา “เข้างาน” แล้วถึงเวลา **23:00 น.** ระบบจะลงเวลา “ออกงาน” ให้อัตโนมัติ

#### ตารางเวร

- โหลดตารางเวรจาก collection: `schedules`
- แสดงตารางเวรล่วงหน้า
- แสดงสถานะเวรของ “วันนี้” บน badge

#### ระบบลา

- ฟอร์มแจ้งลา
  - ประเภทการลา: ลาป่วย / ลากิจ / ลาพักร้อน
  - วันเริ่ม / วันสิ้นสุด
  - เหตุผล
- บันทึกใบลาลง collection: `leave_requests`
  - สถานะเริ่มต้น: Pending
- แสดงประวัติการลาของผู้ใช้

### 2) ระบบ Admin (หน้าแดชบอร์ด)

- Login สำหรับแอดมินแบบ **Magic Link** ผ่าน Firebase Auth
- จำกัดสิทธิ์เข้าใช้ด้วยอีเมลแอดมินที่กำหนด

#### มุมมองแดชบอร์ด/เครื่องมือ

- มีการแบ่งแท็บ/ส่วนเครื่องมือการจัดการ (ตาม UI เดิม)
- ดูข้อมูลลงเวลาแบบตาราง
  - เวลา
  - รูปโปรไฟล์
  - รหัส
  - ชื่อ-สกุล
  - แผนก
  - สถานะ (เข้างาน/ออกงาน)
  - อุปกรณ์ (Mobile/PC)
- กรองข้อมูลตามวันที่
- Export รายงานเป็นไฟล์ CSV

#### ฟีเจอร์การจัดการเพิ่มเติม (ตามของเดิม)

- ปฏิทิน/ตารางเวร (FullCalendar)
- สีแผนก/การจัดการแผนกในปฏิทิน
- เครื่องมือจัดการรายการลงเวลา (เช่น ลบรายการ) ตามความสามารถใน UI เดิม

## โครงสร้างข้อมูล (Firestore)

- `users`
  - `lineUserId`
  - `displayName`
  - `pictureUrl`
  - `empId`
  - `name`
  - `dept`
  - `status`
- `attendance`
  - `userId`
  - `type`
  - `timestamp`
  - `location`
  - `mapUrl`
  - `userAgent`
- `schedules`
  - `userId`
  - `date`
  - `shiftDetail`
- `leave_requests`
  - `userId`
  - `type`
  - `startDate`
  - `endDate`
  - `reason`
  - `status`
  - `requestedAt`

## การใช้งาน

- เปิด `index.html` ผ่าน HTTPS (จำเป็นสำหรับ LIFF และ Geolocation)
- เปิด `admin.html` สำหรับแอดมิน

## หมายเหตุ

- โปรเจคนี้เป็นไฟล์ HTML แบบ static ที่เชื่อม Firebase/LIFF ผ่าน CDN
- การตั้งค่า Firebase และ LIFF ID ถูกกำหนดในไฟล์ HTML

## สีประจำแผนก (Department Colors)

ระบบจะแสดงสีที่แตกต่างกันสำหรับแต่ละแผนกเพื่อความสะดวกในการแยกแยะ ดังนี้:

| แผนก (Department) | สี (Color) |
|-------------------|------------|
| Pharmacy / เภสัช | <span style="color:#198754">#198754 (เขียว)</span> |
| General / ทั่วไป | <span style="color:#0dcaf0">#0dcaf0 (ฟ้าอมน้ำเงิน)</span> |
| IT / ไอที | <span style="color:#6f42c1">#6f42c1 (ม่วง)</span> |
| Admin / ธุรการ | <span style="color:#dc3545">#dc3545 (แดง)</span> |
| Sales / การตลาด | <span style="color:#fd7e14">#fd7e14 (ส้ม)</span> |
| อื่นๆ | <span style="color:#6c757d">#6c757d (เทา)</span> |

สีเหล่านี้จะปรากฏในส่วนต่างๆ ของระบบ เช่น ตารางแสดงข้อมูลพนักงาน, ปฏิทิน, และรายงาน
